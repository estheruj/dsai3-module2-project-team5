// dbdiagram.io

Table dim_category {
  product_category_name string [pk] 
  product_category_name_english string
}

Table dim_customers {
  customer_id string [pk] 
  customer_unique_id string
  customer_zip_prefix string
  customer_city string
  customer_state string
  location_key string
}

Table dim_date {
  date_key integer [pk] 
  full_date date
  year integer
  quarter integer
  month integer
  day integer
  week_of_year integer
  day_of_week integer
  is_weekend boolean
}

Table dim_location {
  location_key string [pk] 
  zip_prefix string
  city string
  state string
  latitude float
  longitude float
}

Table dim_products {
  product_id string [pk] 
  category_name_pt string
  product_name_length numeric
  product_description_length numeric
  product_photos_qty numeric
  product_weight_g numeric
  product_length_cm numeric
  product_height_cm numeric
  product_width_cm numeric
}

Table dim_sellers {
  seller_id string [pk] 
  seller_zip_prefix string
  seller_city string
  seller_state string
  location_key string
}

Table fact_order_items {
  order_item_key string [pk] 
  order_id string
  order_item_id integer
  product_id string
  seller_id string 
  shipping_limit_date timestamp
  price numeric
  freight_value numeric
  gross_item_value numeric
}

Table fact_orders {
  order_id string [pk] 
  customer_id string
  order_status string
  purchase_ts timestamp
  approved_ts timestamp
  delivered_carrier_ts timestamp
  delivered_customer_ts timestamp
  estimated_delivery_ts timestamp
  purchase_date_key integer
  delivered_date_key integer
  approval_lead_time_days integer
  carrier_lead_time_days integer
  delivery_lead_time_days integer
  delivery_delay_days integer
  delivery_is_late boolean
}

Table fact_payments {
  payment_key string [pk] 
  order_id string
  payment_sequential integer
  payment_type string
  payment_installments integer
  payment_value numeric
}

Table fact_reviews {
  review_id string [pk] 
  order_id string
  review_score integer
  review_comment_title string
  review_comment_message string
  review_creation_ts timestamp
  review_answer_ts timestamp
  low_score_flag boolean
  complaint_text_present boolean
}

Table util_geo_zip_centroid {
  zip_prefix string [pk] 
  city string
  state string
  latitude float
  longitude float
}

Table util_orders_delivery_metrics {
  order_id string [pk] 
  approval_lead_time_days integer
  carrier_lead_time_days integer
  delivery_lead_time_days integer
  delivery_delay_days integer
  delivery_is_late boolean
}

Table util_payments_by_order {
  order_id string [pk] 
  total_payment_value numeric
  max_installments integer
  primary_payment_type string
}

Table util_products_enriched {
  product_id string [pk] 
  product_category_name string
  product_category_name_english string
  product_name_length numeric
  product_description_length numeric
  product_photos_qty numeric
  product_weight_g numeric
  product_length_cm numeric
  product_height_cm numeric
  product_width_cm numeric
}

// DIMENSION JOINS
Ref: dim_customers.location_key > dim_location.location_key
Ref: dim_sellers.location_key > dim_location.location_key

// FACT TABLE JOINS (fact_orders)
Ref: fact_orders.customer_id > dim_customers.customer_id
Ref: fact_orders.purchase_date_key > dim_date.date_key
Ref: fact_orders.delivered_date_key > dim_date.date_key

// FACT TABLE JOINS (fact_order_items)
Ref: fact_order_items.product_id > dim_products.product_id
Ref: fact_order_items.seller_id > dim_sellers.seller_id
// Note: fact_order_items.order_id to fact_orders.order_id is assumed to be a composite key/join

// OTHER FACT JOINS
Ref: fact_payments.order_id > fact_orders.order_id
Ref: fact_reviews.order_id > fact_orders.order_id

// UTILITY JOINS
Ref: dim_products.category_name_pt > dim_category.product_category_name
Ref: util_products_enriched.product_category_name > dim_category.product_category_name
Ref: util_orders_delivery_metrics.order_id > fact_orders.order_id
Ref: util_payments_by_order.order_id > fact_orders.order_id